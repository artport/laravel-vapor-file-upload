{"version":3,"file":"laravel-vapor-file-upload.min.modern.js","sources":["../src/laravel-vapor-file-upload.js"],"sourcesContent":["export default class Vapor\n{\n    /**\n     * Retrieve a signed storage link to upload with.\n     *\n     */\n    static async requestSignedUrl(file, options = {})\n    {\n        return JSON.parse(await function() {\n            return new Promise(function(resolve) {\n                let request = new XMLHttpRequest();\n\n                request.open('POST', '/vapor/signed-storage-url');\n                request.onload = () => resolve(request.response);\n\n                request.setRequestHeader('Content-Type', 'application/json');\n                request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n                request.setRequestHeader('X-CSRF-TOKEN', System.Server.csrf());\n\n                request.send(JSON.stringify({\n                    bucket       : options.bucket || '',\n                    content_type : options.contentType || file.type,\n                    expires      : options.expires || '',\n                    visibility   : options.visibility || 'public-read',\n                }));\n            });\n        }());\n    }\n\n    /**\n     * Send the given file using the given signed storage url.\n     *\n     */\n    static async sendFile(url, file, options = {}, headers = {})\n    {\n        return await function() {\n            return new Promise(function(resolve) {\n                let request = new XMLHttpRequest();\n\n                request.open('PUT', url);\n                request.onload = () => resolve(request.response);\n\n                if (options.progress) {\n                    request.upload.onprogress = (e) => options.progress(\n                        Math.ceil((e.loaded / e.total) * 100)\n                    );\n                }\n\n                for (const header in headers) {\n                    request.setRequestHeader(header, headers[header]);\n                }\n\n                request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n                request.setRequestHeader('X-CSRF-TOKEN', System.Server.csrf());\n                request.setRequestHeader('Content-Type', options.contentType || file.type);\n\n                request.send(file);\n            });\n        }();\n    }\n\n    /**\n     * Store a file in S3 and return its UUID, key, and other information.\n     *\n     */\n    static async store(file, options = {})\n    {\n        let response = await this.requestSignedUrl(file, options);\n\n        if ('Host' in response.headers) delete response.headers['Host'];\n        if ('Content-Type' in response.headers) delete response.headers['Content-Type'];\n\n        await this.sendFile(response.url, file, options, response.headers);\n\n        if (file.name) response.extension = file.name.split('.').pop();\n\n        return response;\n    }\n}"],"names":["Vapor","requestSignedUrl","file","options","JSON","parse","Promise","resolve","request","XMLHttpRequest","open","onload","response","setRequestHeader","System","Server","csrf","send","stringify","bucket","content_type","contentType","type","expires","visibility","sendFile","url","headers","progress","upload","onprogress","e","Math","ceil","loaded","total","header","store","this","name","extension","split","pop"],"mappings":"AAAe,MAAMA,EAMjB,6BAAaC,CAAiBC,EAAMC,EAAU,CAAA,GAE1C,OAAOC,KAAKC,YACD,IAAIC,QAAQ,SAASC,GACxB,IAAIC,EAAU,IAAIC,eAElBD,EAAQE,KAAK,OAAQ,6BACrBF,EAAQG,OAAS,IAAMJ,EAAQC,EAAQI,UAEvCJ,EAAQK,iBAAiB,eAAgB,oBACzCL,EAAQK,iBAAiB,mBAAoB,kBAC7CL,EAAQK,iBAAiB,eAAgBC,OAAOC,OAAOC,QAEvDR,EAAQS,KAAKb,KAAKc,UAAU,CACxBC,OAAehB,EAAQgB,QAAU,GACjCC,aAAejB,EAAQkB,aAAenB,EAAKoB,KAC3CC,QAAepB,EAAQoB,SAAW,GAClCC,WAAerB,EAAQqB,YAAc,gBAE7C,GAER,CAMA,qBAAaC,CAASC,EAAKxB,EAAMC,EAAU,CAAA,EAAIwB,EAAU,IAErD,iBACerB,QAAQ,SAASC,GACxB,IAAIC,EAAU,IAAIC,eAElBD,EAAQE,KAAK,MAAOgB,GACpBlB,EAAQG,OAAS,IAAMJ,EAAQC,EAAQI,UAEnCT,EAAQyB,WACRpB,EAAQqB,OAAOC,WAAcC,GAAM5B,EAAQyB,SACvCI,KAAKC,KAAMF,EAAEG,OAASH,EAAEI,MAAS,OAIzC,IAAK,MAAMC,KAAUT,EACjBnB,EAAQK,iBAAiBuB,EAAQT,EAAQS,IAG7C5B,EAAQK,iBAAiB,mBAAoB,kBAC7CL,EAAQK,iBAAiB,eAAgBC,OAAOC,OAAOC,QACvDR,EAAQK,iBAAiB,eAAgBV,EAAQkB,aAAenB,EAAKoB,MAErEd,EAAQS,KAAKf,EACjB,EAER,CAMA,kBAAamC,CAAMnC,EAAMC,EAAU,CAAE,GAEjC,IAAIS,QAAiB0B,KAAKrC,iBAAiBC,EAAMC,GASjD,MAPI,SAAUS,EAASe,gBAAgBf,EAASe,QAAc,KAC1D,iBAAkBf,EAASe,gBAAgBf,EAASe,QAAQ,sBAEtDW,KAACb,SAASb,EAASc,IAAKxB,EAAMC,EAASS,EAASe,SAEtDzB,EAAKqC,OAAM3B,EAAS4B,UAAYtC,EAAKqC,KAAKE,MAAM,KAAKC,OAElD9B,CACX"}